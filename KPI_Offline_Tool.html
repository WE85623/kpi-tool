<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KPI 達成率計算</title>
  <style>
    body { font-family: "Noto Sans TC", sans-serif; background: #FAFAFA; padding: 1em; margin: 0; }
    h1 { font-size: 1.8em; color: #2c3e50; text-align: center; margin-bottom: 0.5em; }
    h2 { margin-top: 2em; color: #34495e; font-size: 1.4em; border-left: 6px solid #3498db; padding-left: 10px; }
    p { text-align: center; color: #7f8c8d; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 2em; background: #fff; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.05); overflow: hidden; }
    th, td { padding: 10px; text-align: center; border-bottom: 1px solid #eee; }
    th { background-color: #ecf0f1; color: #2c3e50; font-weight: bold; }
    input[type=number] { width: 80px; padding: 6px; border: 1px solid #ccc; border-radius: 4px; }
    .result { font-weight: bold; }
    .pass { color: #27ae60; }
    .fail { color: #e74c3c; }
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr { display: block; }
      th { display: none; }
      td { position: relative; padding-left: 50%; border: none; border-bottom: 1px solid #eee; }
      td:before { position: absolute; top: 10px; left: 10px; width: 45%; white-space: nowrap; font-weight: bold; color: #7f8c8d; }
      td:nth-of-type(1):before { content: "KPI 指標"; }
      td:nth-of-type(2):before { content: "分子 A"; }
      td:nth-of-type(3):before { content: "分母 B"; }
      td:nth-of-type(4):before { content: "結果"; }
    }
  </style>
</head>
<body>
  <h1>KPI 即時計算工具（可離線使用）</h1>
  <p>請依照每個部門的 KPI 指標輸入數據，系統將自動計算達成率。</p>
  <div id="tables"></div>

  <script>
    const kpiData = {...}; // 此處略去原始 kpiData 內容，實際程式碼中會保留完整部門資料

    const container = document.getElementById("tables");
    for (let dept in kpiData) {
      const section = document.createElement("div");
      section.innerHTML += `<h2>${dept}</h2>`;
      let html = `<table><thead><tr><th>KPI 指標</th><th>分子 A</th><th>分母 B</th><th>結果</th></tr></thead><tbody>`;
      kpiData[dept].forEach((kpi, index) => {
        const id = `${dept}-${index}`;
        if (kpi.input === "fixed") {
          html += `<tr><td>${kpi.name}</td><td colspan="2">請手動評估</td><td class="result">✔️/❌</td></tr>`;
        } else {
          html += `<tr>
            <td>${kpi.name}</td>
            <td><input type="number" id="${id}-a" oninput="calculate('${id}', ${kpi.threshold}, ${!!kpi.reverse})"></td>
            <td><input type="number" id="${id}-b" oninput="calculate('${id}', ${kpi.threshold}, ${!!kpi.reverse})"></td>
            <td id="${id}-result" class="result"></td>
          </tr>`;
        }
      });
      html += `</tbody></table>`;
      section.innerHTML += html;
      container.appendChild(section);
    }

    function calculate(id, threshold, reverse=false) {
      const a = parseFloat(document.getElementById(`${id}-a`).value);
      const b = parseFloat(document.getElementById(`${id}-b`).value);
      const resultCell = document.getElementById(`${id}-result`);
      if (!isNaN(a) && !isNaN(b) && b !== 0) {
        const value = (a / b) * 100;
        resultCell.innerText = value.toFixed(1) + "%";
        const pass = reverse ? value <= threshold : value >= threshold;
        resultCell.className = pass ? "result pass" : "result fail";
      } else {
        resultCell.innerText = "";
        resultCell.className = "result";
      }
    }
  </script>
</body>
</html>
